@if (loading()) {
<app-placeholder></app-placeholder>
} @else {
@if (error() && error()!.action === 'list') {
<p class="text-red-600">
	Error loading services: {{ error()!.message }}
</p>
} @else {
@if (service()) {

<div class="sub-card">
	<div class="flex justify-between">
		<h2 class="sub-card-title">Service {{ service()!.spec.name || service()!.metadata.name || 'N/A' }}</h2>
		<p class="content-label-value">{{ service()!.status?.status || 'N/A' }}</p>
	</div>


	<div class="grid gap-6 md:grid-cols-2">
		<div>
			<p class="content-label">Domain Name</p>
			<p class="content-label-value">{{ service()!.spec.domain || 'N/A' }}</p>
		</div>
		<div>
			<p class="content-label">Cache Tier</p>
			<p class="content-label-value">{{ service()!.spec.cache || 'N/A' }}</p>
		</div>
	</div>
</div>


<div class="sub-card">
	<div class="flex justify-between">
		<h2 class="sub-card-title">Upstream Configuration</h2>
	</div>

	@if (service()!.spec.originType === 'static') {
	@if (service()!.spec.staticOrigins?.length) {
	<div class="grid gap-4 md:grid-cols-2">
		@for (origin of service()!.spec.staticOrigins; track $index) {
		<div class="rounded-lg border border-gray-200 p-4 dark:border-gray-800">
			<p class="content-label">Upstream</p>
			<p class="content-label-value">{{ origin.upstream || 'N/A' }}</p>
			<p class="content-label">Host Header</p>
			<p class="content-label-value">{{ origin.hostHeader || 'N/A' }}</p>
			<p class="content-label">Scheme</p>
			<p class="content-label-value">{{ origin.scheme || 'N/A' }}</p>
			<p class="content-label">Port</p>
			<p class="content-label-value">{{ origin.port || 'N/A' }}</p>
		</div>
		}
	</div>
	} @else {
	<p class="content-label-value">N/A</p>
	}
	}

	@if (service()!.spec.originType === 's3') {
	@if (service()!.spec.s3OriginSpec?.length) {
	<div class="grid gap-4 md:grid-cols-2">
		@for (origin of service()!.spec.s3OriginSpec; track $index) {
		<div class="rounded-lg border border-gray-200 p-4 dark:border-gray-800">
			<p class="content-label">Bucket</p>
			<p class="content-label-value">{{ origin.s3BucketName || 'N/A' }}</p>
			<p class="content-label">Region</p>
			<p class="content-label-value">{{ origin.s3Region || 'N/A' }}</p>
			<p class="content-label">Access Key</p>
			<p class="content-label-value">{{ origin.s3AccessKeyId || 'N/A' }}</p>
			<p class="content-label">Signature Version</p>
			<p class="content-label-value">{{ origin.awsSigsVersion || 'N/A' }}</p>
			<p class="content-label">Server</p>
			<p class="content-label-value">
				{{ origin.s3Server || 'Default' }}{{ origin.s3ServerPort ? ':' + origin.s3ServerPort : '' }}
			</p>
			<p class="content-label">Protocol</p>
			<p class="content-label-value">{{ origin.s3ServerProto || 'N/A' }}</p>
			<p class="content-label">Style</p>
			<p class="content-label-value">{{ origin.s3Style || 'N/A' }}</p>
		</div>
		}
	</div>
	} @else {
	<p class="content-label-value">N/A</p>
	}
	}

	<div class="mt-6 grid gap-6 md:grid-cols-2">
		<div>
			<h3 class="content-label">Host Aliases</h3>
			@if (service()!.spec.hostAliases?.length) {
			<ul class="list-disc pl-5">
				@for (alias of service()!.spec.hostAliases; track $index) {
				<li class="content-label-value">{{ alias.name }}</li>
				}
			</ul>
			} @else {
			<p class="content-label-value">N/A</p>
			}
		</div>
	</div>
</div>

<div class="sub-card">
	<div class="flex justify-between">
		<h2 class="sub-card-title">Security</h2>
	</div>

	<div class="mt-6 grid gap-6">
		<p class="content-label">WAF</p>
		<p class="content-label-value">{{ service()!.spec.waf!.enabled ? 'Enabled' : 'Disabled' }}</p>
	</div>

	<div class="mt-6 gap-6">
		<div class="flex items-center justify-between">
			<h3 class="content-label">Secure Keys</h3>
			<button type="button" (click)="addKey()" class="btn-primary">Add Key</button>
		</div>
		@if (service()!.spec.secureKeys?.length) {
		<div class="max-w-full overflow-x-auto">
			<table class="w-full table-auto">
				<thead class="border-gray-100 border-y dark:border-white/[0.05]">
					<tr>
						<th scope="col" class="table-label">Name</th>
						<th scope="col" class="table-label">Value</th>
						<th scope="col" class="table-label hidden md:table-cell">Created At</th>
						<th scope="col"></th>
					</tr>
				</thead>
				<tbody class="table-divider">
					@for (key of service()!.spec.secureKeys; track $index) {
					<tr>
						<td class="base-text py-3">{{ key.name || 'Unnamed' }}</td>
						<td class="base-text">
							<div class="flex items-center gap-2">
								<span>{{ isKeyVisible($index) ? (key.value || 'N/A') :
									'********************************' }}</span>
								<button type="button"
									class="inline-flex items-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
									(click)="toggleKeyVisibility($index)"
									[attr.aria-label]="isKeyVisible($index) ? 'Hide value' : 'Show value'">
									<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18"
										fill="currentColor">
										<path
											d="M12 5c-7.633 0-11 7-11 7s3.367 7 11 7 11-7 11-7-3.367-7-11-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10zm0-8a3 3 0 1 0 0 6 3 3 0 0 0 0-6z" />
									</svg>
								</button>
								<button type="button"
									class="inline-flex items-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
									(click)="copyKeyValue($index, key.value)" aria-label="Copy value">
									<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18"
										fill="currentColor">
										<path
											d="M16 1H6a2 2 0 0 0-2 2v12h2V3h10V1zm3 4H10a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2zm0 16H10V7h9v14z" />
									</svg>
								</button>
								@if (isClipboardClicked($index)) {
								<span class="text-green-500">Copied!</span>
								}
							</div>
						</td>
						<td class="base-text hidden md:table-cell ">
							{{ key.createdAt ? (key.createdAt | date:'short') : 'N/A' }}
						</td>
						<td>
							<button type="button"
								class="inline-flex items-center text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-200"
								(click)="deleteKey(key)" aria-label="Delete key">
								<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18"
									fill="currentColor">
									<path
										d="M9 3h6a1 1 0 0 1 1 1v1h4v2h-1v13a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V7H4V5h4V4a1 1 0 0 1 1-1zm1 4v12h2V7h-2zm4 0v12h2V7h-2zM9 5v1h6V5H9z" />
								</svg>
							</button>
						</td>
					</tr>
					}
				</tbody>
			</table>
		</div>
		} @else {
		<p class="content-label-value">N/A</p>
		}
	</div>
</div>

} @else {
<p class="content-label-value">Service not found.</p>
}
}
}


<app-modal [isOpen]="isOpen()" (close)="closeModal()" className="max-w-[700px] p-6 lg:p-10">
	@if (modalSelector().type == 'key-add') {
	<app-key-add [serviceId]="service()!.metadata.name" (onKeyAdded)="closeModalDelayed(1500)" />
	}

	@if (modalSelector().type == 'key-delete') {
	<app-key-delete [serviceId]="service()!.metadata.name" [keyName]="modalSelector()!.params!.keyName" (onKeyDeleted)="closeModalDelayed(1500)" />
	}
</app-modal>